const [[n, m], ...board] = require('fs')
  .readFileSync(process.platform === 'linux' ? '/dev/stdin' : 'input.txt')
  .toString()
  .split('\n')
  .map((str) => str.split(' ').map(Number));

/**
 * Pseudo Code - í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ë¦¬ (ì´ 19ê°€ì§€)
 *
 * Brute Force
 *
 * 1. í…ŒíŠ¸ë¡œë¯¸ë…¸ëŠ” ê¸°ë³¸ 5ê°€ì§€ í˜•íƒœ: I, O, L, Z, T
 *
 * 2. I (ë§‰ëŒ€)
 *   - ê°€ë¡œ: [0,0], [0,1], [0,2], [0,3]
 *   - ì„¸ë¡œ: [0,0], [1,0], [2,0], [3,0]
 *   â†’ ì´ 2ê°€ì§€
 *
 * 3. O (ì •ì‚¬ê°í˜•)
 *   - ì •ì‚¬ê°í˜•: [0,0], [0,1], [1,0], [1,1]
 *   â†’ ì´ 1ê°€ì§€
 *
 * 4. L (ã„±ì ëª¨ì–‘)
 *   - ê¸°ë³¸ L ëª¨ì–‘ íšŒì „: 4ê°€ì§€ (ì‹œê³„ ë°©í–¥ 90ë„ì”© íšŒì „)
 *   - ëŒ€ì¹­ (ì¢Œìš° ë°˜ì „) L ëª¨ì–‘ íšŒì „: 4ê°€ì§€
 *   â†’ ì´ 8ê°€ì§€
 *
 * 5. Z (ì§€ê·¸ì¬ê·¸)
 *   - Z ê°€ë¡œ í˜•íƒœ: 2ê°€ì§€ (ì›í˜• + ëŒ€ì¹­)
 *   - Z ì„¸ë¡œ í˜•íƒœ: 2ê°€ì§€ (ì›í˜• + ëŒ€ì¹­)
 *   â†’ ì´ 4ê°€ì§€
 *
 * 6. T (ã…—ì ëª¨ì–‘)
 *   - ã…—, ã…œ, ã…“, ã… ë„¤ ë°©í–¥
 *   â†’ ì´ 4ê°€ì§€
 *
 * ğŸ”¢ ì´í•©: 2(I) + 1(O) + 8(L) + 4(Z) + 4(T) = 19ê°€ì§€ ëª¨ì–‘
 *
 * ì´ 19ê°€ì§€ ë¸”ëŸ­ì„ (i, j)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒëŒ€ ì¢Œí‘œë¡œ ëª¨ë‘ í•˜ë“œì½”ë”© í›„,
 * ë³´ë“œ ì „ì²´ë¥¼ ìˆœíšŒí•˜ë©´ì„œ í•´ë‹¹ ë¸”ëŸ­ì„ ëŒ€ì…í•´ë³´ê³  ë²”ìœ„ ë‚´ì¼ ê²½ìš° í•© ê³„ì‚°
 */

const tetrominoShapes = [
  // I
  [
    [0, 0],
    [0, 1],
    [0, 2],
    [0, 3],
  ],
  [
    [0, 0],
    [1, 0],
    [2, 0],
    [3, 0],
  ],

  // O
  [
    [0, 0],
    [1, 0],
    [0, 1],
    [1, 1],
  ],

  // L
  [
    [0, 0],
    [1, 0],
    [2, 0],
    [2, 1],
  ],
  [
    [0, 0],
    [1, 0],
    [0, 1],
    [0, 2],
  ],
  [
    [0, 0],
    [0, 1],
    [1, 1],
    [2, 1],
  ],
  [
    [1, 0],
    [1, 1],
    [1, 2],
    [0, 2],
  ],
  [
    [0, 0],
    [0, 1],
    [0, 2],
    [1, 2],
  ],
  [
    [2, 0],
    [0, 1],
    [1, 1],
    [2, 1],
  ],
  [
    [0, 0],
    [1, 0],
    [1, 1],
    [1, 2],
  ],
  [
    [0, 0],
    [1, 0],
    [2, 0],
    [0, 1],
  ],

  // Z
  [
    [0, 0],
    [1, 0],
    [1, 1],
    [2, 1],
  ],
  [
    [0, 0],
    [0, 1],
    [1, 1],
    [1, 2],
  ],
  [
    [1, 0],
    [1, 1],
    [0, 1],
    [0, 2],
  ],
  [
    [0, 0],
    [1, 0],
    [1, -1],
    [2, -1],
  ],

  // T
  [
    [0, 0],
    [1, 0],
    [2, 0],
    [1, 1],
  ],
  [
    [0, 0],
    [0, 1],
    [0, 2],
    [1, 1],
  ],
  [
    [1, 0],
    [0, 1],
    [1, 1],
    [1, 2],
  ],
  [
    [1, 0],
    [0, 1],
    [1, 1],
    [2, 1],
  ],
];

let maxSum = 0;

for (let y = 0; y < n; y++) {
  for (let x = 0; x < m; x++) {
    for (const shape of tetrominoShapes) {
      let sum = 0;
      let isValid = true;

      for (const [dy, dx] of shape) {
        const ny = y + dy;
        const nx = x + dx;

        if (ny < 0 || ny >= n || nx < 0 || nx >= m) {
          isValid = false;
          break;
        }

        sum += board[ny][nx];
      }

      if (isValid) {
        maxSum = Math.max(maxSum, sum);
      }
    }
  }
}

console.log(maxSum);

/** Pseudo Code - DFS
 *
 * 1. í…ŒíŠ¸ë¡œë¯¸ë…¸ëŠ” ë¸”ë¡ 4ê°œë¥¼ ì—°ê²°í–ˆì„ ë•Œ ê°€ì¥ í° ê°’ì„ êµ¬í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì—
 * DFSë¡œ ìƒí•˜ì¢Œìš°ë¥¼ ì „ë¶€ ìˆœíšŒí•˜ë©´ì„œ ê°€ì¥ í° 4ê°œì˜ ë¸”ë¡ì˜ í•©ì„ êµ¬í•˜ë©´ ë¨.
 *
 * 2. DFSëŠ” í•œ ë²ˆì— í•œê°œì”©ì˜ stepë§Œ íƒìƒ‰í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ë¥¸ stepì€ íƒìƒ‰í•  ìˆ˜ ì—†ìŒ.
 * e.g.) ì¢Œí‘œ (2, 3)ì—ì„œ íƒìƒ‰í•  ìˆ˜ ìˆëŠ” ë‹¤ìŒ ë¶„ê¸°ëŠ” (2, 2), (2, 4), (1, 3), (3, 3)ì´ ìˆëŠ”ë°
 * ì˜ˆë¥¼ ë“¤ì–´ (1, 3)ì„ íƒìƒ‰í–ˆìœ¼ë©´ ë‹¤ì‹œ (2, 3)ìœ¼ë¡œ ëŒì•„ì™€ì•¼ë§Œ (2, 4)ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤.
 * ì¦‰, (2, 3)ê³¼ (2, 4)ë¥¼ ë™ì‹œì— íƒìƒ‰í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
 *
 * 3. 2ì˜ ì´ìœ  ë•Œë¬¸ì— Tìí˜• ë¸”ë¡ì˜ ê²½ìš° 2ë²ˆì§¸ ë¸”ë¡ê¹Œì§€ íƒìƒ‰í•œ ë‹¤ìŒ ë™ì‹œì— 2ê°œë¥¼ íƒìƒ‰í•˜ì§€ ëª»í•¨
 *
 * 4. ê° stepë³„ë¡œ ìƒí•˜ì¢Œìš°ë¥¼ ì „ë¶€ DFSë¡œ íƒìƒ‰í•œë‹¤. stepì€ 1ë¶€í„° ì‹œì‘í•˜ê³ , DFS ì¬ê·€ë¥¼ í•œë²ˆ ìˆœíšŒí• ë•Œë§ˆë‹¤
 * stepì„ 1ì”© ì¶”ê°€í•´ì¤€ë‹¤.
 *
 * 5. 4ë¥¼ ì‹¤í–‰ ì¤‘ì—, ë‹¤ìŒ stepì˜ DFSë¥¼ ì‹¤í–‰í•˜ê¸° ì´ì „ì— í˜„ì¬ ë¸”ëŸ­ì„ íƒìƒ‰í–ˆë‹¤ê³  visitedë¡œ í‘œì‹œí•œë‹¤.
 *
 * 6. stepì´ 2ì¼ë•Œ ì²˜ìŒ ì‹œì‘ ì¢Œí‘œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜†ìœ¼ë¡œ íŠ€ì–´ë‚˜ì˜¨ ë¸”ëŸ­ DFSê°€ í•„ìš”í•˜ë¯€ë¡œ ì²˜ìŒ ì‹œì‘ì ìœ¼ë¡œ
 * ëŒì•„ê°€ëŠ” ë¶„ê¸°ë¥¼ ë§Œë“ ë‹¤. ë¶„ê¸°ë¥¼ ë§Œë“¤ì–´ì„œ Tìí˜• ëª¨ì–‘ ê°’ì„ êµ¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
 * e.g)
 * 1) step 1
 * 1-1) visited -> (2, 2)
 * 1-2) total === board[2][2]
 * 1-3) í˜„ì¬ ìœ„ì¹˜ (2, 2)
 * 1-4) í˜„ì¬ step === 1
 *
 * 2) step 2, ìœ„ë¡œ ìš°ì„  ì›€ì§ì¸ë‹¤ (1, 2)
 * 2-1) visited -> (2, 2), (1, 2)
 * 2-2) total = board[2][2] + board[1][2]
 * 2-3) í˜„ì¬ ìœ„ì¹˜ (1, 2)
 * 2-4) í˜„ì¬ step === 2
 *
 * 3) step 2ì—ì„œ ë³µê·€ë¡œ ë¶„ê¸°í•œ step 3
 * í˜„ì¬ ì¢Œí‘œì—ì„œ stepì„ 1ì„ ëˆŒë¦¬ê³  ì¬ì‹œì‘ í•˜ì§€ë§Œ
 * ìƒë‹¨ board[0][2]ì˜ ê°’ì„ totalì— ë”í•´ì£¼ê³  (0, 2)ë¥¼ visitedë¡œ ì²´í¬í•œë‹¤.
 * ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ (0, 2)ë¥¼ í•œë²ˆ ê°”ë‹¤ì˜¨ ìƒíƒœì¸ block 3ê°œì¸ Iì ëª¨ì–‘ì—ì„œ, ìƒí•˜ì¢Œìš°ë¡œ ì‚ì ¸ë‚˜ì˜¨ ë¶€ë¶„ì„
 * ìˆœíšŒí•  ìˆ˜ ìˆê²Œ ë˜ì–´ Tìí˜• ëª¨ì–‘ì— ëŒ€ì‘í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
 * 3-1) visited -> (2, 2), (1, 2), (0, 2)
 * 3-2) total === board[2][2] + board[1][2] + board[0][2]
 * 3-3) í˜„ì¬ ìœ„ì¹˜ (1, 2)
 * 3-4) í˜„ì¬ step === 3
 *
 *
 * 4) step 4 -> ì™¼ìª½
 * ì´ì œ (1, 2)ì—ì„œ ë°©ë¬¸í•˜ì§€ ì•Šì€ ì™¼ìª½, ì˜¤ë¥¸ìª½ ë¸”ëŸ­ì˜ë¡œ ì´ë™í•˜ë©´ì„œ step 4ë¥¼ ë§Œë“¤ê³ , max ê°’ì„ ë¹„êµí•˜ê³  ë¦¬í„´í•œë‹¤.
 * ìš°ì„  ì™¼ìª½ìœ¼ë¡œ ì´ë™í•˜ì—¬ ê°’ì„ êµ¬í•œë‹¤.
 * 4-1) visited -> (2, 2), (1, 2), (0, 2), (1, 1)
 * 4-2) total === board[2][2] + board[1][2] + board[0][2] + board[1][1]
 * 4-3) í˜„ì¬ ìœ„ì¹˜ (1, 1)
 * 4-4) í˜„ì¬ step === 4
 *
 * 5) step 4 -> ì˜¤ë¥¸ìª½
 * 4-1) visited -> (2, 2), (1, 2), (0, 2), (1, 3)
 * 4-2) total === board[2][2] + board[1][2] + board[0][2] + board[1][3]
 * 4-3) í˜„ì¬ ìœ„ì¹˜ (1, 3)
 * 4-4) í˜„ì¬ step === 4
 *
 * 7. ë§Œì•½ í˜„ì¬ ë‚¨ì€ stepì— ëª¨ë‘ maxê°’ì„ ë”í•´ë„ í˜„ì¬ ìµœëŒ€ê°’ë³´ë‹¤ ì‘ë‹¤ë©´, ì–¼ë¦¬ ë¦¬í„´í•œë‹¤
 * 8. step === 4ì—ì„œ êµ¬í•œ ê°’ì„ ì´ì „ ìµœëŒ€ê°’(answer)ì™€ ë¹„êµí•œ ë’¤ ë” í¬ë‹¤ë©´ ì‹ ê·œ ìµœëŒ€ê°’ìœ¼ë¡œ answerë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.
 * 9. ìµœì¢…ì ìœ¼ë¡œ answerë¥¼ ì œì¶œí•œë‹¤.
 */

const visited = Array.from({ length: n }, () => Array(m).fill(false));

const maxBoardValue = board.reduce((acc, cur) => {
  const curRowMax = Math.max(...cur);
  acc = Math.max(acc, curRowMax);

  return acc;
}, 0);

// flatì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‚˜ flatì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë§ìŒ
// const maxBoardValue = Math.max(...board.flat());

const dy = [-1, 1, 0, 0];
const dx = [0, 0, -1, 1];

let answer = 0;

const dfs = (y, x, step, total) => {
  if (total + maxBoardValue * (4 - step) <= answer) {
    return;
  }

  if (step === 4) {
    answer = Math.max(answer, total);
    return;
  }

  for (let i = 0; i < 4; i++) {
    const ny = y + dy[i];
    const nx = x + dx[i];

    if (ny < 0 || nx < 0 || ny >= n || nx >= m) continue;
    if (visited[ny][nx]) continue;

    if (step === 2) {
      visited[ny][nx] = true;
      dfs(y, x, step + 1, total + board[ny][nx]);
      visited[ny][nx] = false;
    }

    visited[ny][nx] = true;
    dfs(ny, nx, step + 1, total + board[ny][nx]);
    visited[ny][nx] = false;
  }
};

for (let y = 0; y < n; y++) {
  for (let x = 0; x < m; x++) {
    visited[y][x] = true;
    dfs(y, x, 1, board[y][x]);
    visited[y][x] = false;
  }
}

console.log(answer);
